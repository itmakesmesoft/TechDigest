
# ğŸš€ Husky pre-push í›… ìŠ¤í¬ë¦½íŠ¸: íŠ¹ì • ì›ê²© ì €ì¥ì†Œì™€ ë¸Œëœì¹˜ë¡œì˜ push ë°©ì§€

# ğŸ”’ ê¸ˆì§€í•  ì›ê²© ì €ì¥ì†Œ URL ì„¤ì • (HTTPS ë° SSH ë°©ì‹)
FORBIDDEN_HTTPS_URL="https://github.com/itmakesmesoft/TechDigest.git" # ì›ê²© ì €ì¥ì†Œ URL (HTTPS)
FORBIDDEN_SSH_URL="git@github.com:itmakesmesoft/TechDigest.git"       # ì›ê²© ì €ì¥ì†Œ URL (SSH)

# ğŸ”’ Pushë¥¼ ê¸ˆì§€í•  ë¸Œëœì¹˜ ì„¤ì •
FORBIDDEN_REF="refs/heads/main" # ë§ˆìŠ¤í„° ë¸Œëœì¹˜ (refs/heads/<ë¸Œëœì¹˜ëª…> í˜•ì‹)

# ğŸš€ Huskyì—ì„œ ì œê³µí•˜ëŠ” Git Hook ê´€ë ¨ ë³€ìˆ˜ë“¤ì„ ë°°ì—´ë¡œ ë³€í™˜
ARR_GIT_PARAMS=($(echo $HUSKY_GIT_PARAMS)) # Git ëª…ë ¹ì–´ì—ì„œ ì „ë‹¬ëœ ì¸ìë“¤ (ì˜ˆ: ì›ê²© ì €ì¥ì†Œ URL ë“±)
ARR_GIT_STDIN=($(echo $HUSKY_GIT_STDIN))   # Git í‘¸ì‹œ ì‹œ ì „ë‹¬ë˜ëŠ” í‘œì¤€ ì…ë ¥ ê°’ (ë¸Œëœì¹˜ ì •ë³´ ë“±)

# ğŸ·ï¸ ì›ê²© ì €ì¥ì†Œ ì •ë³´ ì¶”ì¶œ
remote=${ARR_GIT_PARAMS[0]}  # ì›ê²© ì´ë¦„ (ì˜ˆ: origin)
url=${ARR_GIT_PARAMS[1]}      # ì›ê²© ì €ì¥ì†Œ URL (ì˜ˆ: git@github.com:user/repo.git)

# ğŸ·ï¸ Push ê´€ë ¨ ì •ë³´ ì¶”ì¶œ
local_ref=${ARR_GIT_STDIN[0]}  # ë¡œì»¬ ë¸Œëœì¹˜ ì°¸ì¡° (ì˜ˆ: refs/heads/feature-branch)
local_sha=${ARR_GIT_STDIN[1]}  # ë¡œì»¬ SHA (ì˜ˆ: ì»¤ë°‹ í•´ì‹œ)
remote_ref=${ARR_GIT_STDIN[2]} # ì›ê²© ë¸Œëœì¹˜ ì°¸ì¡° (ì˜ˆ: refs/heads/master)
remote_sha=${ARR_GIT_STDIN[3]} # ì›ê²© SHA (ì˜ˆ: ì»¤ë°‹ í•´ì‹œ)

# âœ… ë‹¤ë¥¸ ì›ê²© ì €ì¥ì†Œë¡œì˜ í‘¸ì‹œëŠ” í—ˆìš© (ê¸ˆì§€ëœ ì €ì¥ì†Œê°€ ì•„ë‹ ê²½ìš° ë°”ë¡œ ì¢…ë£Œ)
if [ "$url" != "$FORBIDDEN_HTTPS_URL" -a "$url" != "$FORBIDDEN_SSH_URL" ]
then
    exit 0 # ê¸ˆì§€ëœ ì €ì¥ì†Œê°€ ì•„ë‹ˆë¯€ë¡œ push í—ˆìš©
fi

# âŒ ê¸ˆì§€ëœ ë¸Œëœì¹˜(master)ë¡œ push ì‹œë„ ì‹œ ì°¨ë‹¨
if [ "$remote_ref" == "$FORBIDDEN_REF" ]
then
    echo "âŒ main ë¸Œëœì¹˜ë¡œ ì§ì ‘ pushí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." # ì‚¬ìš©ìì—ê²Œ ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥
    exit 1 # ì—ëŸ¬ ì½”ë“œ ë°˜í™˜ -> push ì°¨ë‹¨
fi

# âœ… ëª¨ë“  ê²€ì‚¬ë¥¼ í†µê³¼í•˜ë©´ ì •ìƒì ìœ¼ë¡œ push ì§„í–‰
exit 0